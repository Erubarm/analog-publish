I. Введение: Роль сетевого уровня и основы маршрутизации

1. **Сетевой уровень в иерархии протоколов**

    ◦ Задача сетевого уровня (Уровень 3): передача пакетов от отправителя к получателю через множество маршрутизаторов (в отличие от канального уровня, который работает только между непосредственно соединенными устройствами),,.

    ◦ Пакет может совершить много "скачков" (хопов).

    ◦ **Маршрутизация (Routing)** vs. **Пересылка (Forwarding)**: Маршрутизация — это процесс построения и обновления таблиц маршрутизации (выбор пути); Пересылка — это использование этих таблиц для выбора исходящей линии для прибывшего пакета.

2. **Два основных режима работы сетевого уровня (Краткий обзор)**

    ◦ **Дейтаграммные сети (Connectionless/IP):** Пакеты (дейтаграммы) маршрутизируются независимо, решение о пути принимается для каждого пакета отдельно. Принципы IP: доставка "по возможности" (best effort), отсутствие гарантий надежности,,.

    ◦ **Сети виртуальных каналов (Virtual Circuits/MPLS):** Фиксированный маршрут (виртуальный канал) определяется один раз при установлении соединения. Пакеты содержат короткий идентификатор канала,,.

3. **Критерии качества алгоритмов маршрутизации**

    ◦ Алгоритмы должны быть **корректными**, **простыми**, **надежными** (способны справляться со сбоями), **устойчивыми** (быстрая конвергенция), **эффективными** (минимизация задержки, увеличение пропускной способности).

    ◦ **Принцип оптимальности:** Если маршрутизатор J находится на оптимальном пути от I до K, то оптимальный путь от J до K совпадает с частью исходного пути. Набор оптимальных маршрутов образует **входное дерево** (sink tree),.

II. Классические алгоритмы маршрутизации в рамках одной сети

1. **Общие сведения: Неадаптивные vs. Адаптивные алгоритмы**

    ◦ **Неадаптивные (Статическая маршрутизация):** Пути определяются заранее (например, вручную) и не меняются в зависимости от текущей топологии или трафика.

    ◦ **Адаптивные (Динамическая маршрутизация):** Алгоритмы реагируют на изменения топологии (сбои) и, возможно, на загруженность линий (трафик),.

2. **Метод поиска кратчайшего пути (Алгоритм Дейкстры)**

    ◦ Цель: Найти кратчайшие пути от одного узла ко всем остальным.

    ◦ **Метрика:** Расстояние может измеряться количеством хопов (транзитных участков), физической длиной или стоимостью (обратно пропорциональна пропускной способности или времени задержки),.

    ◦ **Работа алгоритма:** Использует временные и постоянные метки для нахождения кратчайших путей. Постоянные метки не меняются,.

3. **Маршрутизация по вектору расстояний (Distance Vector Routing, DVA)**

    ◦ **Принцип:** Маршрутизаторы обмениваются с **непосредственными соседями** таблицами (векторами), содержащими кратчайшие расстояния до всех известных сетей,.

    ◦ **Обновление:** Маршрутизатор J получает вектор соседа A, добавляет к метрикам расстояние от J до A, и если находит более короткий путь до сети X, обновляет свою таблицу,.

    ◦ **Недостаток — Проблема счета до бесконечности:** Медленная реакция на "плохие новости" (отказ линии/маршрутизатора). Маршрутизаторы медленно увеличивают расстояние до недоступной сети. Причина — использование информации, полученной из "вторых рук",,.

4. **Маршрутизация с учетом состояния линий (Link State Routing, LSA)**

    ◦ **Принцип:** Каждый маршрутизатор собирает полную топологию сети (граф) и самостоятельно вычисляет кратчайшие пути с помощью алгоритма Дейкстры,,.

    ◦ **Пять шагов LSA:**

        1. Обнаружение соседей (пакеты HELLO),.

        2. Определение стоимости связи (на основе пропускной способности, задержки).

        3. Создание пакетов состояния линий (LSA-объявлений) с информацией о себе и своих связях,.

        4. Распространение LSA по сети методом **лавинной адресации** (flooding),.

        5. Вычисление кратчайшего пути,.

    ◦ **Преимущества:** Быстрая сходимость и устойчивость к сбоям,.

    ◦ **Протоколы:** OSPF и IS-IS,.

III. Специализированные алгоритмы маршрутизации

1. **Иерархическая маршрутизация**

    ◦ **Назначение:** Решение проблем масштабируемости в очень крупных сетях за счет сокращения размера таблиц маршрутизации.

    ◦ **Механизм:** Разбиение сети на **области (areas)**. Маршрутизатор знает все детали своей области, но только адресные сводки о других областях,.

    ◦ **Протоколы:** OSPF поддерживает деление на области, включая магистральную область (Area 0),.

2. **Групповая (Многоадресная) маршрутизация (Multicasting)**

    ◦ **Назначение:** Эффективная доставка пакета группе получателей (например, при потоковой трансляции видео).

    ◦ **Механизм:** Маршрутизаторы реплицируют пакеты только на "развилках", ведущих к членам группы (покрытие деревом),.

    ◦ **Концепция продвижения по реверсивному пути (Reverse Path Forwarding, RPF):** Маршрутизатор принимает пакет, только если он пришел по кратчайшему пути от источника. Это предотвращает зацикливание и дублирование,.

3. **Произвольная маршрутизация (Anycasting)**

    ◦ **Назначение:** Доставка пакета **ближайшему** члену группы. Применяется для сервисов, где важен ответ, а не конкретный сервер (например, DNS-серверы),.

    ◦ **Механизм:** Используются стандартные алгоритмы маршрутизации (DVA/LSA), но нескольким узлам присваивается один и тот же адрес. Маршрутизатор просто выбирает кратчайший путь до этого адреса.

IV. Управление трафиком и контроль перегрузки

1. **Перегрузка в сетях (Congestion)**

    ◦ **Причина:** Сеть не может обработать поступающий трафик (нагрузка превышает пропускную способность), что приводит к росту задержки, заполнению буферов и потере пакетов,.

    ◦ **Коллапс сети:** Ситуация, когда рост нагрузки ведет к снижению полезной пропускной способности (goodput).

    ◦ **Контроль vs. Управление:** **Контроль перегрузок** (на транспортном уровне) регулирует скорость отправки хостов. **Управление трафиком** (на сетевом уровне) — методы, применяемые операторами для борьбы с перегрузкой (например, маршрутизация, формирование трафика).

2. **Реагирующие методы борьбы с перегрузкой (Сетевой уровень)**

    ◦ **Сброс нагрузки (Load Shedding):** Маршрутизатор отбрасывает пакеты.

        ▪ **Стратегии удаления:** "Молочная" (удаление старых, если важна актуальность данных, например, для видео) или "Винная" (удаление новых, если важна последовательность).

        ▪ **RED (Random Early Detection):** Случайное удаление пакетов, когда очередь превышает пороговое значение, чтобы косвенно уведомить отправителей о начале перегрузки (до того, как буфер переполнится).

    ◦ **Явное уведомление (ECN):** Маршрутизатор маркирует пакеты, чтобы уведомить получателя (тот, в свою очередь, уведомляет отправителя) о перегрузке,.

3. **Протоколы контроля перегрузки (Транспортный уровень/TCP)**

    ◦ **Закон AIMD (Additive Increase Multiplicative Decrease):** Алгоритм, обеспечивающий справедливое и эффективное распределение пропускной способности: аддитивное увеличение скорости при отсутствии потерь и мультипликативное уменьшение при получении сигнала о перегрузке (потере пакета),.

    ◦ **Окно перегрузки (Congestion Window, cwnd):** Регулирует количество байтов, отправляемых в сеть.

    ◦ **Алгоритм медленного старта (Slow Start):** Экспоненциальный рост cwnd в начале соединения для быстрого определения доступной пропускной способности.

4. **Превентивные методы: Формирование трафика**

    ◦ **Алгоритм дырявого ведра (Leaky Bucket)** / **Алгоритм маркерного ведра (Token Bucket):** Сглаживание неравномерного трафика для соответствия заданным профилям. Ограничивает как среднюю скорость, так и максимальный размер "пульсации" трафика,,.

    ◦ **Управление допуском (Admission Control):** В сетях виртуальных каналов: отклонение новых запросов на соединение, если они могут вызвать перегрузку,.
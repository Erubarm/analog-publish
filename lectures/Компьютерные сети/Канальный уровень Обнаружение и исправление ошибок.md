I. Введение. Роль и задачи Канального уровня

**1.1. Место в иерархии протоколов**

Канальный уровень (Уровень 2) располагается прямо над Физическим уровнем (Уровень 1) в пятиуровневой эталонной модели, используемой для описания сетей.

• **Задача:** Преобразование необработанного потока битов, поступающего с физического уровня, в поток целых блоков информации — **фреймов** (или кадров), которые могут использоваться сетевым уровнем.

• **Фундаментальное допущение:** В отличие от сетевого уровня, который соединяет удаленные хосты через множество маршрутизаторов, канальный уровень работает только между **непосредственно соединенными устройствами** (например, через кабель или беспроводной канал), при этом биты принимаются в том же порядке, в каком передаются.

**1.2. Ключевые функции Канального уровня**

Протоколы канального уровня решают несколько ключевых задач:

1. **Формирование фрейма** (Framing): Разбиение потока битов на дискретные, четко ограниченные фреймы.

2. **Обработка ошибок** (Error Control): Обнаружение и исправление ошибок передачи, возникающих в физическом канале.

3. **Управление потоком** (Flow Control): Предотвращение переполнения буфера медленного получателя данными от быстрого отправителя.

4. **Предоставление служб Сетевому уровню:** Обеспечение строго очерченного интерфейса для вышележащего уровня.

II. Обнаружение и коррекция ошибок: Общие принципы 

Сбойные биты при передаче остаются важным фактором в сетях, особенно в беспроводных. Для борьбы с этим используются избыточные данные, добавляемые к информационным битам.

**2.1. Природа ошибок**

Ошибки могут возникать в каналах связи по разным причинам, таким как скачки электричества или глубокое замирание беспроводного канала.

• **Изолированные однобитовые ошибки (Isolated Single-bit Errors):** Возникают из-за теплового шума и воздействуют на отдельные биты.

• **Пакеты ошибок (Burst Errors):** Возникают целыми последовательностями из-за временных помех (например, электрические помехи в кабеле или замирание сигнала в беспроводном канале). Пакет ошибок исправить сложнее, чем изолированные ошибки.

**2.2. Основные стратегии борьбы**

Существует две основные стратегии, основанные на добавлении избыточной информации:

1. **Прямая коррекция ошибок (Forward Error Correction, FEC) / Корректирующие коды:** Позволяют приемнику не только обнаружить, но и самостоятельно исправить ошибку, основываясь на избыточных данных.

    ◦ _Применяется в:_ Зашумленных каналах (например, беспроводных или спутниковых), где повторная передача может быть затруднена или неэффективна.

2. **Автоматический запрос повторной передачи (Automatic Repeat reQuest, ARQ) / Коды обнаружения ошибок:** Приемник лишь оповещает об обнаружении ошибки, после чего запрашивает повторную передачу всего блока (фрейма).

    ◦ _Применяется в:_ Высоконадежных каналах (например, оптоволоконных), где ошибки редки, и повторная передача более экономична, чем использование большого количества избыточных корректирующих битов.

**2.3. Обнаружение ошибок**

Коды обнаружения ошибок относятся к линейным систематическим блочным кодам.

• **Код с проверкой на четность (Parity Check Code):** Наиболее простой метод, добавляется один бит четности.

   ◦ _Возможности:_ Обнаруживает **только одиночные ошибки**. Двойная ошибка не будет обнаружена. Расстояние Хемминга равно 2.

• **Циклический избыточный код (Cyclic Redundancy Check, CRC):** Наиболее популярный и надежный метод обнаружения ошибок на канальном уровне, также известный как полиномиальный код.

   ◦ _Принцип:_ Битовые строки представляются в виде многочленов (полиномов) с коэффициентами 0 или 1. Передаваемый фрейм дополняется контрольными битами (CRC) так, чтобы получившийся многочлен делился на заранее согласованный **образующий многочлен** G(x) без остатка. Получатель выполняет обратную операцию.

   ◦ _Возможности:_ Код CRC с r контрольными битами обнаруживает все **пакеты ошибок длиной** **\leq r**, все одиночные ошибки и все ошибки с нечетным количеством инвертированных битов.

   ◦ _Применение:_ Широко используется в аппаратном обеспечении сетей, включая Ethernet, 802.11, DOCSIS, PPP.

III. Корректирующие коды (Forward Error Correction, FEC)

Корректирующие коды добавляют больше избыточности, чем коды обнаружения, чтобы позволить приемнику восстановить исходное сообщение. Способность кода исправлять d ошибок зависит от его **расстояния Хемминга**, которое должно быть ≥2d+1.

**3.1. Коды Хемминга**

• **Принцип:** Линейный блочный код, способный исправлять **одиночные ошибки**.

• **Механизм:** Контрольные биты (биты с номерами, равными степеням 2: 1, 2, 4, 8, ...) вычисляют четность определенных групп битов данных. При обнаружении ошибки набор проверочных результатов формирует **синдром ошибки**, который указывает на позицию сбойного бита.

• _Ограничение:_ Эффективны для изолированных ошибок, но плохо работают с пакетами ошибок.

**3.2. Сверточные коды**

• **Принцип:** Неблочный код, где выходной бит зависит от текущего и предыдущих входных битов (длина кодового ограничения). Они вводят избыточность, обрабатывая последовательность входных битов.

• _Применение:_ Широко используются в беспроводных сетях, например, в GSM и 802.11.

• **Декодирование с мягким принятием решений (Soft-decision decoding):** Декодирование, при котором учитывается не только значение бита (0 или 1), но и степень уверенности в этом значении (например, полученное напряжение 0.9 В — "очень вероятная единица"). Это повышает надежность исправления ошибок.

**3.3. Коды Рида—Соломона и LDPC**

• **Коды Рида—Соломона (Reed—Solomon code):** Линейные блочные коды, которые работают на группах из m-битовых **символов**, а не на отдельных битах.

   ◦ _Эффективность:_ Отлично справляются с **пакетами ошибок**, поскольку пакет ошибок в 128 бит может быть обработан как одна символьная ошибка.

   ◦ _Применение:_ Используются в DSL, кабельных и спутниковых сетях, а также на CD/DVD/Blu-ray.

• **Коды с малой плотностью проверок на четность (LDPC):** Линейные блочные коды с высокой эффективностью исправления ошибок, часто превосходящие другие коды.

   ◦ _Применение:_ Используются в современных стандартах: 10 Гбит/с Ethernet, DOCSIS 3.1, 802.11ax, и активно внедряются в новые протоколы.

IV. Протоколы с положительным подтверждением и повторной передачей (ARQ) (30 мин)

Механизмы ARQ (Automatic Repeat reQuest) используются для обеспечения надежности передачи в логическом канале путем сочетания нумерации фреймов, таймеров и повторных передач.

**4.1. Протокол с остановкой и ожиданием (Stop-and-Wait)**

Простейший протокол ARQ, в котором отправитель посылает один фрейм и должен дождаться положительного подтверждения (ACK), прежде чем отправить следующий.

• **Проблема зависания:** Если фрейм данных или подтверждение теряется в канале, отправитель может зависнуть.

   ◦ _Решение:_ Использование **таймеров**. После отправки фрейма запускается таймер. Если подтверждение не приходит до истечения тайм-аута, фрейм отправляется повторно.

• **Проблема дублирования:** Если теряется только ACK, а фрейм дошел, отправитель повторяет его передачу после тайм-аута.

   ◦ _Решение:_ **Порядковые номера (Sequence Numbers).** Получатель использует порядковый номер, чтобы отличить новый фрейм от дубликата, который нужно игнорировать. Для протокола с остановкой и ожиданием достаточно использовать один бит для нумерации (0 или 1).

**4.2. Повышение эффективности: Конвейеризация и раздвижное окно**

Протокол с остановкой и ожиданием неэффективен, когда велико произведение пропускной способности на задержку (bandwidth-delay product, BD).

• **Конвейеризация (Pipelining):** Разрешение отправителю посылать сразу несколько фреймов (окно размером w), не дожидаясь подтверждения каждого.

   ◦ Чтобы конвейер работал безостановочно, размер окна w должен быть ≥2BD+1.

• **Протоколы раздвижного окна (Sliding Window):** Используются для реализации конвейеризации, позволяя отправителю хранить в буфере фреймы, для которых еще не получены подтверждения.

**4.3. Стратегии восстановления при конвейеризации**

При потере фрейма в конвейере последующие фреймы могут прийти раньше, чем отправитель обнаружит ошибку. Поскольку сетевой уровень получателя должен получать пакеты строго по порядку, возникают две стратегии обработки этой ситуации:

1. **Протокол с возвратом к N (Go-back-N):**

    ◦ **Действия получателя:** Получатель **игнорирует** все фреймы, следующие за ошибочным/потерянным (окно получателя размером 1). Он отправляет **кумулятивное подтверждение** (ACK на последний правильно принятый по порядку фрейм).

    ◦ **Действия отправителя:** После тайм-аута отправитель возвращается к ошибочному фрейму и **повторно передает его и все последующие** фреймы.

    ◦ _Недостаток:_ Неэффективно при высоком уровне ошибок и большом BD, так как много корректных фреймов передается повторно.

2. **Протокол с выборочным повтором (Selective Repeat):**

    ◦ **Действия получателя:** Получатель **принимает и буферизирует** фреймы, пришедшие не по порядку, если они попадают в его окно. Он может отправить **отрицательное подтверждение (NAK)**, чтобы ускорить повторную передачу.

    ◦ **Действия отправителя:** Повторно отправляется **только** самый старый неподтвержденный фрейм (или фрейм, на который получен NAK).

    ◦ _Требование:_ Размер окна отправителя должен быть ограничен (MAX_SEQ + 1)/2 для предотвращения ошибок дублирования старых фреймов.

V. Заключение и примеры применения 

**5.1. Практическое использование**

• **ADSL:** В линиях ADSL, которые являются достаточно зашумленными, используется сложный механизм исправления ошибок. Он включает коды **Рида—Соломона** для FEC, а также 1-байтный CRC для обнаружения оставшихся отклонений.

• **DOCSIS:** В кабельных сетях DOCSIS (Data Over Cable Service Interface Specification) FEC является ключевым элементом, так как исходящий поток данных в коаксиальном кабеле очень зашумлен. Современные версии DOCSIS (3.1) используют мощные коды **LDPC** для упреждающего исправления ошибок. Для обнаружения ошибок также используются коды CRC.

• **Надежные и ненадежные службы:** В проводных и оптоволоконных каналах, где частота ошибок низка, часто используется служба **без подтверждений и без установления соединения** (например, Ethernet), оставляя заботу о надежности верхним уровням. В ненадежных беспроводных сетях (802.11) используются **службы с подтверждениями** на канальном уровне для быстрого устранения ошибок
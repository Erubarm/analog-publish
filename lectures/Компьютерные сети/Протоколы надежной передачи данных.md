Введение: Основы надежности и уровни 

**1.1. Надежность как цель проектирования** Надежность — это ключевое свойство сети, позволяющее ей работать корректно, даже если ее компоненты ненадежны. Передаваемые биты пакета могут быть искажены (инвертированы) из-за теплового шума, электрических скачков или ошибок аппаратного обеспечения.

**1.2. Где обеспечивается надежность?** Надежность является общей целью, требующей слаженной работы всех уровней протоколов.

• **Канальный уровень (Data Link Layer):** Обеспечивает надежную передачу данных между двумя непосредственно связанными узлами (абстракция двухточечных соединений). Ключевые функции: формирование фрейма, обработка ошибок, управление потоком.

• **Транспортный уровень (Transport Layer):** Отвечает за сквозную передачу данных между процессами на хостах, предоставляя необходимый уровень надежности независимо от характеристик нижележащих сетей.

_Ссылка на предыдущие лекции:_ Ранее мы обсуждали, что ненадежные службы, такие как IP (сетевой уровень) или Ethernet (канальный уровень), не гарантируют доставку пакетов. Именно протоколы, ориентированные на установление соединения, такие как TCP, строятся поверх этих ненадежных служб для обеспечения надежности.

Часть I: Механизмы борьбы с ошибками

Надежность достигается за счет обнаружения и исправления ошибок.

**2.1. Природа ошибок**

1. **Изолированные однобитовые ошибки (Isolated Single-bit Errors):** Возникают из-за теплового шума и влияют на отдельные биты.

2. **Пакеты ошибок (Burst Errors):** Последовательности ошибок, вызванные временными помехами (например, электрические помехи, замирание беспроводного сигнала). Их сложнее исправить, чем изолированные ошибки.

**2.2. Основные стратегии борьбы с ошибками** Обе стратегии основаны на добавлении избыточных данных:

1. **Прямая коррекция ошибок (Forward Error Correction, FEC) / Корректирующие коды:** Приемник самостоятельно исправляет ошибку, используя избыточные данные.

    ◦ _Применение:_ Зашумленные каналы (беспроводные, спутниковые, ADSL, DOCSIS), где повторная передача затруднена или неэффективна.

2. **Автоматический запрос повторной передачи (Automatic Repeat reQuest, ARQ) / Коды обнаружения ошибок:** Приемник обнаруживает ошибку, отбрасывает фрейм и запрашивает его повторную передачу.

    ◦ _Применение:_ Высоконадежные каналы (оптоволоконные), где ошибки редки, и повторная передача экономичнее, чем использование большого количества корректирующих битов.

**2.3. Коды обнаружения ошибок (Error Detecting Codes)** Относятся к линейным систематическим блочным кодам.

• **Код с проверкой на четность (Parity Check Code):** Простейший метод, добавляется один бит четности.

   ◦ _Возможности:_ Обнаруживает **только одиночные ошибки**. Двойная ошибка не обнаруживается. Расстояние Хемминга равно 2.

• **Циклический избыточный код (Cyclic Redundancy Check, CRC):** Наиболее популярный и надежный метод на канальном уровне, также известен как полиномиальный код.

   ◦ _Принцип:_ Битовые строки представляются многочленами. Передаваемый фрейм дополняется контрольными битами так, чтобы получившийся многочлен делился на образующий многочлен G(x) без остатка.

   ◦ _Возможности:_ CRC с r контрольными битами обнаруживает все **пакеты ошибок длиной** **\leq r**, все одиночные ошибки и все ошибки с нечетным количеством инвертированных битов.

   ◦ _Применение:_ Широко используется в Ethernet, 802.11, DOCSIS, PPP.

**2.4. Корректирующие коды (FEC)** Требуют больше избыточности. Способность кода исправлять d ошибок зависит от его **расстояния Хемминга**, которое должно быть ≥2d+1.

• **Коды Хемминга:** Линейный блочный код, способный исправлять **одиночные ошибки**. Эффективен для изолированных ошибок.

• **Сверточные коды:** Неблочный код; выходной бит зависит от текущего и предыдущих входных битов. Широко используются в беспроводных сетях, например, GSM и 802.11.

• **Коды Рида—Соломона:** Эффективны для исправления пакетов ошибок (символьных ошибок). Используются в ADSL, кабельных сетях, на CD/DVD/Blu-ray.

• **Коды LDPC (Low-Density Parity Check):** Отлично справляются с ошибками при больших блоках, превосходя многие другие коды. Используются в 10 Гбит/с Ethernet, DOCSIS 3.1, 802.11ax.

Часть II: Протоколы ARQ и управление потоком 

Механизмы ARQ (Automatic Repeat reQuest) обеспечивают надежность логического канала, используя нумерацию фреймов, таймеры и повторные передачи.

**3.1. Управление потоком (Flow Control)** Управление потоком предотвращает переполнение буфера медленного получателя данными от быстрого отправителя. Если отправитель посылает фреймы быстрее, чем получатель может их обработать, фреймы будут теряться. Простейшее решение — обратная связь от получателя, который отправляет разрешение на отправку следующего фрейма.

**3.2. Протокол с остановкой и ожиданием (Stop-and-Wait)** Самый простой протокол ARQ. Отправитель посылает один фрейм и ждет положительного подтверждения (ACK), прежде чем отправить следующий. Проблемы и решения для Stop-and-Wait:

• **Проблема зависания:** Если фрейм данных или ACK теряется, отправитель может зависнуть.

   ◦ _Решение:_ Использование **таймеров**. Если тайм-аут истек, фрейм отправляется повторно.

• **Проблема дублирования:** Если теряется только ACK, отправитель повторяет передачу после тайм-аута, что приводит к дублированию на стороне получателя.

   ◦ _Решение:_ Использование **порядковых номеров (Sequence Numbers)**. Для Stop-and-Wait достаточно одного бита для нумерации (0 или 1). Получатель отличает дубликат от нового фрейма.

**3.3. Повышение эффективности: Конвейерная обработка и раздвижное окно** Протокол Stop-and-Wait неэффективен при больших задержках или высокой пропускной способности, поскольку отправитель простаивает.

• **Конвейерная обработка (Pipelining):** Разрешение отправителю посылать сразу несколько фреймов (W) до того, как придет подтверждение.

• **Протоколы раздвижного окна (Sliding Window):** Класс протоколов, который объединяет контроль ошибок и управление потоком. Каждый исходящий фрейм имеет порядковый номер, и окно определяет диапазон разрешенных к передаче, но еще не подтвержденных фреймов.

   ◦ Подтверждение обычно содержит номер последнего полученного без ошибок фрейма.

   ◦ **Вложенное подтверждение (Piggybacking):** Откладывание ACK и его присоединение к следующему исходящему фрейму данных в обратном направлении для эффективного использования пропускной способности.

**3.4. Стратегии ARQ при конвейерной обработке**

1. **Протокол с возвратом на N (Go-Back-N):**

    ◦ **Окно получателя:** Размер окна получателя равен 1.

    ◦ **Действия получателя:** Игнорирует все фреймы, следующие за ошибочным (так как они пришли не по порядку).

    ◦ **Действия отправителя:** После тайм-аута или получения NAK (если используется), отправитель возвращается к ошибочному фрейму и **повторно передает его и все последующие** неподтвержденные фреймы.

    ◦ _Недостаток:_ Неэффективно при высоком уровне ошибок, так как много корректных фреймов передается повторно.

2. **Протокол с выборочным повтором (Selective Repeat):**

    ◦ **Окно получателя:** Получатель имеет окно и **буферизует** фреймы, пришедшие не по порядку, если они попадают в его окно.

    ◦ **Действия получателя:** Может отправить **отрицательное подтверждение (NAK)**, чтобы ускорить повторную передачу.

    ◦ **Действия отправителя:** Повторно отправляется **только** самый старый неподтвержденный фрейм (или фрейм, на который получен NAK).

    ◦ _Преимущество:_ Эффективнее использует пропускную способность, поскольку повторно передаются только потерянные фреймы.

    ◦ _Требование:_ Размер окна отправителя должен быть ограничен (MAX_SEQ+1)/2.

Часть III: Надежность на Транспортном уровне 

**4.1. Сквозной принцип и TCP** Надежная служба часто реализуется протоколами высокого уровня поверх ненадежных служб низких уровней. Транспортный уровень (TCP) обеспечивает **сквозную проверку** на всем пути, что необходимо для корректной передачи данных (End-to-End argument).

• **TCP (Transmission Control Protocol):** Надежный, полнодуплексный, ориентированный на установление соединения протокол, обеспечивающий безошибочную доставку **байтового потока**.

   ◦ TCP разбивает поток на сегменты, управляет их движением, восстанавливает порядок и занимается повторной передачей в случае потери.

   ◦ **Установление соединения:** Используется "тройное рукопожатие" (SYN, SYN/ACK, ACK) для надежного начала связи.

**4.2. Механизмы надежности TCP** Протокол TCP использует механизмы, аналогичные ARQ, но на транспортном уровне и с дополнительными функциями:

1. **Контроль ошибок:** Использует сквозную контрольную сумму (CRC). Если сегмент потерян (из-за ошибки или перегрузки), TCP повторно передает его.

2. **Управление потоком (Flow Control):** Использует протокол раздвижного окна **переменного размера** (Window size). Получатель сообщает отправителю в поле `Window size`, сколько байтов он готов принять, предотвращая переполнение буфера.

3. **Контроль перегрузки (Congestion Control):** TCP использует потерю пакетов как основной сигнал перегрузки в сети. TCP поддерживает **окно перегрузки** (congestion window), которое ограничивает скорость отправки, используя закон управления AIMD (аддитивное увеличение, мультипликативное уменьшение) для справедливого и эффективного распределения пропускной способности.

**4.3. UDP — Ненадежный контраст** Протокол **UDP (User Datagram Protocol)** является ненадежным протоколом без установления соединения (дейтаграммным). Он используется для приложений, которым не требуется или не подходит встроенный в TCP механизм надежности (например, голосовая или видеосвязь в реальном времени, DNS-запросы), поскольку для них важнее быстрота доставки, чем ее точность или сохранение порядка. В UDP вопросы надежности (управление потоком, повторная передача) возлагаются на пользовательские процессы или прикладной уровень.

Часть IV: Практическое применение 

Методы обеспечения надежности выбираются в зависимости от характеристик канала:

• **Высоконадежные проводные/оптоволоконные каналы:** Часто используется служба **без подтверждений и без установления соединения** (например, Ethernet), поскольку частота ошибок низка, а забота о надежности оставляется верхним уровням (TCP).

• **Зашумленные беспроводные каналы (802.11, Wi-Fi):** Характеризуются высокой интенсивностью битовых ошибок (до 10−3 по сравнению с 10−9 в оптоволокне).

   ◦ Здесь используются **службы с подтверждениями** на канальном уровне (ARQ, Stop-and-Wait) для быстрой коррекции ошибок.

   ◦ Повторная передача на канальном уровне скрывает ошибки передачи от транспортного уровня (TCP), чтобы TCP не принимал их за перегрузку, что привело бы к замедлению работы.

• **ADSL/DOCSIS:** В этих зашумленных линиях для упреждающего исправления ошибок применяются мощные коды FEC, такие как **Рида—Соломона** и **LDPC** (особенно в DOCSIS 3.1). Для обнаружения оставшихся ошибок используются CRC.